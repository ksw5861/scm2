<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.yedam.scm.product.mapper.InboundMapper">

  
  <!-- ===== resultMap: DB 컬럼명 → VO 필드명 매핑 (AS 없이) ===== -->
  

 <!-- ===== LOT 목록 조회: Product_LOT 기준 ===== -->
<select id="selectInboundLots"
        resultType="com.yedam.scm.vo.ProductLotVO">
  SELECT
    pl.prd_lot,
    pl.prod_id,
    p.prod_name,
    pl.total_qty,
    pl.remain_qty,
    pl.status,         -- 이제 DB에 '입고대기'가 그대로 들어있으니까 그대로 출력됨
    pp.end_date
  FROM Product_LOT pl
    JOIN product p
      ON p.prod_id = pl.prod_id
    LEFT JOIN product_plan_detail pd
      ON pd.prod_id = pl.prod_id
    LEFT JOIN product_plan pp
      ON pp.pl_id = pd.pl_id
  <where>
    <if test="prodId != null and prodId != ''">
      AND pl.prod_id = #{prodId}
    </if>
    <if test="prodName != null and prodName != ''">
      AND p.prod_name LIKE '%' || #{prodName} || '%'
    </if>
    <if test="endDate != null">
      AND TRUNC(pp.end_date) = TRUNC(#{endDate})
    </if>
    <if test="prdLot != null and prdLot != ''">
      AND pl.prd_lot = #{prdLot}
    </if>
  </where>
  ORDER BY pl.prd_lot DESC
</select>





  <!-- ===== 입고 등록 (item_inbound에 INSERT) ===== -->
  <insert id="insertInbound" parameterType="com.yedam.scm.vo.ItemInboundVO">
    INSERT INTO item_inbound (
      inbound_id, prd_lot, prod_no, prod_id, in_qty, in_date, employee_id, wh_id, prod_name
    ) VALUES (
      #{inboundId}, #{prdLot}, #{prodNo}, #{prodId}, #{inQty},
      NVL(#{inDate}, TRUNC(SYSDATE)), #{employeeId}, #{whId}, #{prodName}
    )
  </insert>

  <!-- ===== 입고 삭제 ===== -->
  <delete id="deleteInbound" parameterType="string">
    DELETE FROM item_inbound WHERE inbound_id = #{inboundId}
  </delete>

  <insert id="callInboundProcess">

  </insert>
  

</mapper>
